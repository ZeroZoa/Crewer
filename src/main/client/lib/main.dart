import 'package:client/components/custom_app_bar.dart';
import 'package:client/providers/auth_provider.dart';
import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import 'package:client/components/bottom_navbar.dart';
import 'package:provider/provider.dart';
import 'package:intl/date_symbol_data_local.dart';

// Screens
import 'package:client/screens/feed_list_screen.dart';
import 'package:client/screens/feed_create_screen.dart';
import 'package:client/screens/feed_edit_screen.dart';
import 'package:client/screens/feed_detail_screen.dart';
import 'package:client/screens/group_feed_create_screen.dart';
import 'package:client/screens/group_feed_edit_screen.dart';
import 'package:client/screens/group_feed_detail_screen.dart';
import 'package:client/screens/map_screen.dart';
import 'package:client/screens/my_profile_screen.dart';
import 'package:client/screens/user_profile_screen.dart';
import 'package:client/screens/user_feed_screen.dart';
import 'package:client/screens/signup_screen.dart';
import 'package:client/screens/chatroom_list_screen.dart';
import 'package:client/screens/chatroom_screen.dart';
import 'package:client/screens/ranking_screen.dart';
import 'package:client/components/login_modal_screen.dart';
import 'package:client/screens/my_feed_screen.dart';
import 'package:client/screens/my_liked_feed_screen.dart';
import 'package:client/screens/running_route_screen.dart';
import 'package:google_maps_flutter/google_maps_flutter.dart';
import 'package:intl/intl.dart';
import 'package:client/screens/follow_list_screen.dart';


void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await initializeDateFormatting('ko_KR');
  runApp(
    ChangeNotifierProvider(
      create: (context) => AuthProvider()..checkLoginStatus(),
      child: const MyApp(),
    ),
  );
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    final GoRouter router = GoRouter(
      initialLocation: '/',
      routes: [
        ShellRoute(
          builder: (context, state, child) {
            final location = state.uri.toString();

            // // --- üìå ÏÉÅÎã®Î∞î(AppBar) ÌëúÏãú Î°úÏßÅ ---
            //
            // // 'Î©îÏù∏' ÌôîÎ©¥Ïù∏ÏßÄ ÌôïÏù∏
            // final mainRoutes = ['/', '/map', '/ranking'];
            //
            // // ÌòÑÏû¨ Í≤ΩÎ°úÍ∞Ä ÏúÑ Î™©Î°ùÏóê Ìè¨Ìï®ÎêòÎäîÏßÄ ÌôïÏù∏ÌïòÏó¨ 'Î©îÏù∏' ÌôîÎ©¥ Ïó¨Î∂ÄÎ•º Í≤∞Ï†ïÌï©ÎãàÎã§.
            // final isMain = mainRoutes.contains(location);
            //
            // // ÏûêÏ≤¥ AppBarÎ•º Í∞ÄÏßÑ ÌôîÎ©¥Îì§ (Ïù¥ Í≤ΩÏö∞ ShellÏùò AppBarÎäî Î≥¥Ïù¥ÏßÄ ÏïäÏùå)
            // final selfAppBarRoutes = [
            //   '/feeds/create', '/groupfeeds/create', '/feeds/', '/groupfeeds/',
            //   '/signup', '/login', '/chat', '/route', '/profile', '/map',
            //   '/ranking', '/me/', '/user/',
            // ];
            //
            // // 3. ShellÏùò Í∏∞Î≥∏ AppBarÎ•º Î≥¥Ïó¨Ï§ÑÏßÄ Í≤∞Ï†ï (Í∞ÑÎã®Ìïú ÌéòÏù¥ÏßÄÏö©)
            // final showShellAppBar = !isMain && !selfAppBarRoutes.any((path) => location.startsWith(path));
            //
            // // 4. ShellÏù¥ AppBarÎ•º Í∑∏Î†§Ïïº Ìï† Í≤ΩÏö∞, ÌÉÄÏûÖ Í≤∞Ï†ï
            // final appBarType = isMain ? AppBarType.main : AppBarType.back;


            // --- üìå ÌïòÎã®Î∞î(BottomNavBar) ÌëúÏãú Î°úÏßÅ (AppBarÏôÄ ÏôÑÏ†ÑÌûà Î∂ÑÎ¶¨) ---

            // 1. ÌïòÎã®Î∞îÍ∞Ä 'Î¨¥Ï°∞Í±¥' Î≥¥Ïó¨Ïïº ÌïòÎäî Í≤ΩÎ°ú Î™©Î°ù
            final bottomNavRoutes = ['/', '/map', '/ranking', '/chat', '/profile'];

            // 2. ÌòÑÏû¨ Í≤ΩÎ°úÍ∞Ä ÏúÑ Î™©Î°ùÏóê Ï†ïÌôïÌûà ÏùºÏπòÌïòÎäîÏßÄ ÌôïÏù∏
            final showBottomNav = bottomNavRoutes.contains(location);


            return Scaffold(
              backgroundColor: Colors.white,
              // isMainÏù¥Í±∞ÎÇò showShellAppBarÍ∞Ä trueÏùº ÎïåÎßå ShellÏùò AppBarÎ•º Í∑∏Î¶º
              // appBar: (isMain || showShellAppBar) ? CustomAppBar(appBarType: appBarType) : null,
              // // showBottomNavÍ∞Ä trueÏùº ÎïåÎßå ÌïòÎã®Î∞îÎ•º Î≥¥ÏûÑ
              bottomNavigationBar: showBottomNav
                  ? BottomNavBar(currentLocation: location)
                  : null,
              body: child,
            );
          },
          routes: [
            // --- ÌôîÎ©¥ Í≤ΩÎ°ú Î™©Î°ù ---
            GoRoute(path: '/', builder: (_, __) =>  FeedListScreen()),
            GoRoute(path: '/signup', builder: (_, __) =>  SignupScreen()),
            GoRoute(path: '/login', builder: (_, __) =>  LoginModalScreen()),
            GoRoute(path: '/profile', builder: (_, __) =>  MyProfileScreen()),
            GoRoute(path: '/map', builder: (_, __) => const MapScreen()),
            GoRoute(path: '/chat', builder: (_, __) => const ChatRoomListScreen()),
            GoRoute(path: '/ranking', builder: (_, __) => const RankingScreen()),
            GoRoute(
              path: '/chat/:chatRoomId',
              builder: (_, state) =>
                  ChatRoomScreen(
                    chatRoomId: state.pathParameters['chatRoomId']!,
                  ),
            ),
            GoRoute(
              path: '/feeds/create',
              builder: (_, __) => const FeedCreateScreen(),
            ),
            GoRoute(
              path: '/groupfeeds/create',
              builder: (_, __) => const GroupFeedCreateScreen(),
            ),
            GoRoute(
              path: '/feeds/:feedId',
              builder: (_, state) =>
                  FeedDetailScreen(feedId: state.pathParameters['feedId']!),
            ),
            GoRoute(
              path: '/feeds/:feedId/edit',
              builder: (_, state) =>
                  FeedEditScreen(feedId: state.pathParameters['feedId']!),
            ),
            GoRoute(
              path: '/groupfeeds/:groupFeedId',
              builder: (_, state) =>
                  GroupFeedDetailScreen(
                    groupFeedId: state.pathParameters['groupFeedId']!,
                  ),
            ),
            GoRoute(
              path: '/groupfeeds/:groupFeedId/edit',
              builder: (_, state) =>
                  GroupFeedEditScreen(
                    groupFeedId: state.pathParameters['groupFeedId']!,
                  ),
            ),
            GoRoute(
              path: '/me/feeds',
              builder: (context, state) => const MyFeedScreen(),
            ),
            GoRoute(
              path: '/me/liked-feeds',
              builder: (context, state) => const MyLikedFeedScreen(),
            ),
            GoRoute(
              path: '/me/followers',
              builder: (_, state) =>
              const FollowListScreen(
                username: 'me',
                isFollowers: true,
              ),
            ),
            GoRoute(
              path: '/me/following',
              builder: (_, state) =>
              const FollowListScreen(
                username: 'me',
                isFollowers: false,
              ),
            ),
            GoRoute(
              path: '/user/:username',
              builder: (_, state) =>
                  UserProfileScreen(
                    username: state.pathParameters['username']!,
                  ),
            ),
            GoRoute(
              path: '/user/:username/feeds',
              builder: (_, state) =>
                  UserFeedScreen(
                    username: state.pathParameters['username']!,
                  ),
            ),
            GoRoute(
              path: '/user/:username/followers',
              builder: (_, state) =>
                  FollowListScreen(
                    username: state.pathParameters['username']!,
                    isFollowers: true,
                  ),
            ),
            GoRoute(
              path: '/user/:username/following',
              builder: (_, state) =>
                  FollowListScreen(
                    username: state.pathParameters['username']!,
                    isFollowers: false,
                  ),
            ),
            GoRoute(
              path: '/route',
              builder: (context, state) {
                final record = state.extra as Map<String, dynamic>;
                final runningDate = DateFormat('yyyyÎÖÑ MÏõî dÏùº \na hÏãú mÎ∂Ñ', 'ko_KR')
                    .format(DateTime.parse(record['createdAt'] as String).toLocal());
                final rawPath = record['path'] as List<dynamic>;
                final path = rawPath.map((p) =>
                    LatLng(p['latitude'] as double, p['longitude'] as double))
                    .toList();
                final distanceKm = (record['totalDistance'] as num) / 1000;
                final totalSeconds = record['totalSeconds'] as int;
                final totalTime = Duration(seconds: totalSeconds);
                final timeStr = [
                  totalTime.inHours.toString().padLeft(2, '0'),
                  (totalTime.inMinutes % 60).toString().padLeft(2, '0'),
                  (totalTime.inSeconds % 60).toString().padLeft(2, '0'),
                ].join(':');
                final paceSec = distanceKm > 0
                    ? (totalTime.inSeconds / distanceKm).round()
                    : 0;
                final pace = Duration(seconds: paceSec);
                final paceStr =
                    '${pace.inMinutes.toString().padLeft(2, '0')}:${(pace.inSeconds % 60).toString().padLeft(2, '0')}';

                return RouteScreen(
                  path: path,
                  distanceKm: distanceKm,
                  timeStr: timeStr,
                  paceStr: paceStr,
                  runningDateStr: runningDate,
                );
              },
            ),
          ],
        ),
      ],
    );

    return MaterialApp.router(
      title: 'Crewer App',
      theme: ThemeData(
        scaffoldBackgroundColor: Colors.white,
        primaryColor: const Color(0xFF9CB4CD),
        visualDensity: VisualDensity.adaptivePlatformDensity,
      ),
      routerConfig: router,
      debugShowCheckedModeBanner: false,
    );
  }
}

// main.dart

// import 'package:client/components/custom_app_bar.dart';
// import 'package:client/providers/auth_provider.dart';
// import 'package:flutter/material.dart';
// import 'package:go_router/go_router.dart';
// import 'package:client/components/bottom_navbar.dart';
//
// // Screens import ÏÉùÎûµ (Í∏∞Ï°¥Ï≤òÎüº Ïú†ÏßÄ)
// import 'package:client/screens/feed_list_screen.dart';
// import 'package:client/screens/feed_create_screen.dart';
// import 'package:client/screens/feed_edit_screen.dart';
// import 'package:client/screens/feed_detail_screen.dart';
// import 'package:client/screens/group_feed_create_screen.dart';
// import 'package:client/screens/group_feed_edit_screen.dart';
// import 'package:client/screens/group_feed_detail_screen.dart';
// import 'package:client/screens/map_screen.dart';
// import 'package:client/screens/my_profile_screen.dart';
// import 'package:client/screens/user_profile_screen.dart';
// import 'package:client/screens/user_feed_screen.dart';
// import 'package:client/screens/signup_screen.dart';
// import 'package:client/screens/chatroom_list_screen.dart';
// import 'package:client/screens/chatroom_screen.dart';
// import 'package:client/screens/ranking_screen.dart';
// import 'package:client/components/login_modal_screen.dart';
// import 'package:client/screens/my_feed_screen.dart';
// import 'package:client/screens/my_liked_feed_screen.dart';
// import 'package:client/screens/running_route_screen.dart';
// import 'package:google_maps_flutter/google_maps_flutter.dart';
// import 'package:intl/intl.dart';
// import 'package:client/screens/follow_list_screen.dart';
// import 'package:provider/provider.dart';
// import 'package:intl/date_symbol_data_local.dart';
//
// void main() async {
//   WidgetsFlutterBinding.ensureInitialized();
//   // ÌïúÍµ≠Ïñ¥ ÎÇ†Ïßú Ìè¨Îß∑ÏùÑ ÏúÑÌïú Ï¥àÍ∏∞Ìôî
//   await initializeDateFormatting('ko_KR');
//   runApp(
//     ChangeNotifierProvider(
//       create: (context) => AuthProvider()..checkLoginStatus(),
//       child: const MyApp(),
//     ),
//   );
// }
//
// class MyApp extends StatelessWidget {
//   const MyApp({super.key});
//
//   @override
//   Widget build(BuildContext context) {
//     final GoRouter router = GoRouter(
//       initialLocation: '/',
//       routes: [
//         ShellRoute(
//           builder: (context, state, child) {
//             final location = state.uri.toString();
//
//             AppBarType appBarType;
//
//             final selfAppBarRoutes = [
//               '/feeds/',
//               '/groupfeeds/',
//               '/signup',
//               '/login',
//               '/chat/',
//               '/route',
//               '/profile',
//               '/map',
//               '/ranking',
//               '/me/', // '/me/feeds' Îì± ÎÇ¥ Ï†ïÎ≥¥ Í¥ÄÎ†® Î™®Îì† ÌéòÏù¥ÏßÄ
//               '/user/', // '/user/username' Îì± Îã§Î•∏ Ïú†Ï†Ä Í¥ÄÎ†® Î™®Îì† ÌéòÏù¥ÏßÄ
//             ];
//
//             final showShellAppBar = !selfAppBarRoutes.any((path) => location.startsWith(path));
//
//             // Î©îÏù∏ ÌôîÎ©¥('/')Ïùº Í≤ΩÏö∞
//             if (location == '/') {
//               appBarType = AppBarType.main;
//             }
//             // AppBarÍ∞Ä ÌïÑÏöîÌïòÍ≥† Îã´Í∏∞ ÌôîÎ©¥Îì§
//             else if (['/signup', '/login'].any((path) => location.startsWith(path))) {
//               appBarType = AppBarType.close;
//             }
//             // else if ([
//             //   '/feeds/', //ÌîºÎìú(ÏÉùÏÑ±, ÏàòÏ†ï, ÏÉÅÏÑ∏) ÌéòÏù¥ÏßÄ
//             //   '/groupfeeds/', //Í∑∏Î£πÌîºÎìú(ÏÉùÏÑ±, ÏàòÏ†ï, ÏÉÅÏÑ∏) ÌéòÏù¥ÏßÄ
//             //   '/chat', //Ï±ÑÌåÖ(Î¶¨Ïä§Ìä∏, Î∞©) ÌéòÏù¥ÏßÄ
//             //   '/route', //Í≤ΩÎ°ú ÌéòÏù¥ÏßÄ
//             //   '/map', //ÏßÄÎèÑ ÌéòÏù¥ÏßÄ
//             //   '/ranking', //Îû≠ÌÇπÌéòÏù¥ÏßÄ
//             //   '/profile', //ÎßàÏù¥ÌéòÏù¥ÏßÄ
//             // ].any((path) => location.startsWith(path))) {
//             //   appBarType = AppBarType.back;
//             // }
//             // 4. Í∑∏ Ïô∏ Î™®Îì† ÌôîÎ©¥ÏùÄ ÏóÜÏùå
//             else {
//               appBarType = AppBarType.none;
//             };
//
//
//             // ÌïòÎã®Î∞îÎ•º Î≥¥Ïó¨Ï£ºÏßÄÏïäÎäî ÌôîÎ©¥Îì§
//             final showBottomNav = ![
//               '/feeds/create',
//               '/groupfeeds/create',
//               '/feeds/',
//               '/groupfeeds/',
//               '/signup',
//               '/login',
//               '/chat/',
//               '/route',
//             ].any((path) => location.startsWith(path));
//
//             return Scaffold(
//               backgroundColor: Colors.white,
//
//               appBar: showShellAppBar ? CustomAppBar(appBarType: AppBarType.back) : null,
//               bottomNavigationBar: showBottomNav
//                   ? BottomNavBar(currentLocation: location)
//                   : null,
//               body: child,
//             );
//           },
//
//           routes: [
//             GoRoute(path: '/', builder: (_, __) => FeedListScreen()),
//             GoRoute(path: '/signup', builder: (_, __) => SignupScreen()),
//             GoRoute(path: '/login', builder: (_, __) => LoginModalScreen()),
//             GoRoute(path: '/profile', builder: (_, __) => MyProfileScreen()),
//             GoRoute(path: '/map', builder: (_, __) => MapScreen()),
//             GoRoute(path: '/chat', builder: (_, __) => ChatRoomListScreen()),
//             GoRoute(path: '/ranking', builder: (_, __) => RankingScreen()),
//             GoRoute(
//               path: '/chat/:chatRoomId',
//               builder:
//                   (_, state) => ChatRoomScreen(
//                 chatRoomId: state.pathParameters['chatRoomId']!,
//               ),
//             ),
//             GoRoute(
//               path: '/feeds/create',
//               builder: (_, __) => FeedCreateScreen(),
//             ),
//             GoRoute(
//               path: '/groupfeeds/create',
//               builder: (_, __) => GroupFeedCreateScreen(),
//             ),
//             GoRoute(
//               path: '/feeds/:feedId',
//               builder:
//                   (_, state) =>
//                   FeedDetailScreen(feedId: state.pathParameters['feedId']!),
//             ),
//             GoRoute(
//               path: '/feeds/:feedId/edit',
//               builder:
//                   (_, state) =>
//                   FeedEditScreen(feedId: state.pathParameters['feedId']!),
//             ),
//             GoRoute(
//               path: '/groupfeeds/:groupFeedId',
//               builder:
//                   (_, state) => GroupFeedDetailScreen(
//                 groupFeedId: state.pathParameters['groupFeedId']!,
//               ),
//             ),
//             GoRoute(
//               path: '/groupfeeds/:groupFeedId/edit',
//               builder:
//                   (_, state) => GroupFeedEditScreen(
//                 groupFeedId: state.pathParameters['groupFeedId']!,
//               ),
//             ),
//             GoRoute(
//               path: '/me/feeds',
//               builder: (context, state) => MyFeedScreen(),
//             ),
//             GoRoute(
//               path: '/me/liked-feeds',
//               builder: (context, state) => MyLikedFeedScreen(),
//             ),
//             GoRoute(
//               path: '/me/followers',
//               builder:
//                   (_, state) => FollowListScreen(
//                 username: 'me', // ÎÇ¥ ÌîÑÎ°úÌïÑÏùò Í≤ΩÏö∞ 'me'Î°ú Ï≤òÎ¶¨
//                 isFollowers: true,
//               ),
//             ),
//             GoRoute(
//               path: '/me/following',
//               builder:
//                   (_, state) => FollowListScreen(
//                 username: 'me', // ÎÇ¥ ÌîÑÎ°úÌïÑÏùò Í≤ΩÏö∞ 'me'Î°ú Ï≤òÎ¶¨
//                 isFollowers: false,
//               ),
//             ),
//             GoRoute(
//               path: '/user/:username',
//               builder:
//                   (_, state) => UserProfileScreen(
//                 username: state.pathParameters['username']!,
//               ),
//             ),
//             GoRoute(
//               path: '/user/:username/feeds',
//               builder:
//                   (_, state) => UserFeedScreen(
//                 username: state.pathParameters['username']!,
//               ),
//             ),
//             GoRoute(
//               path: '/user/:username/followers',
//               builder:
//                   (_, state) => FollowListScreen(
//                 username: state.pathParameters['username']!,
//                 isFollowers: true,
//               ),
//             ),
//             GoRoute(
//               path: '/user/:username/following',
//               builder:
//                   (_, state) => FollowListScreen(
//                 username: state.pathParameters['username']!,
//                 isFollowers: false,
//               ),
//             ),
//             GoRoute(
//               path: '/route',
//               builder: (context, state) {
//                 //state.extraÏóêÏÑú Ï†ÑÏ≤¥ Î†àÏΩîÎìú Í∫ºÎÇ¥Í∏∞
//                 final record = state.extra as Map<String, dynamic>;
//
//                 //Î†àÏΩîÎìú ÏãúÍ∞Ñ Ï†ïÎ≥¥
//                 final runningDate = DateFormat(
//                   'yyyyÎÖÑ MÏõî dÏùº \na hÏãú mÎ∂Ñ',
//                   'ko_KR',
//                 ).format(DateTime.parse(record['createdAt'] as String).toLocal());
//
//                 //Í≤ΩÎ°ú(path) Î≥ÄÌôò: List<dynamic> ‚Üí List<LatLng>
//                 final rawPath = record['path'] as List<dynamic>;
//                 final path =
//                 rawPath
//                     .map(
//                       (p) => LatLng(
//                     p['latitude'] as double,
//                     p['longitude'] as double,
//                   ),
//                 )
//                     .toList();
//
//                 //Í±∞Î¶¨¬∑ÏãúÍ∞Ñ¬∑ÌéòÏù¥Ïä§ Í≥ÑÏÇ∞
//                 final distanceKm = (record['totalDistance'] as num) / 1000;
//                 final totalSeconds = record['totalSeconds'] as int;
//                 final totalTime = Duration(seconds: totalSeconds);
//                 final timeStr = [
//                   totalTime.inHours.toString().padLeft(2, '0'),
//                   (totalTime.inMinutes % 60).toString().padLeft(2, '0'),
//                   (totalTime.inSeconds % 60).toString().padLeft(2, '0'),
//                 ].join(':');
//                 final paceSec = distanceKm > 0 ? (totalTime.inSeconds / distanceKm).round() : 0;
//                 final pace = Duration(seconds: paceSec);
//                 final paceStr =
//                     '${pace.inMinutes.toString().padLeft(2, '0')}:${(pace.inSeconds % 60).toString().padLeft(2, '0')}';
//
//                 // 4) RouteScreenÏóê Î™®Îì† Ï†ïÎ≥¥ Ï†ÑÎã¨
//                 return RouteScreen(
//                   path: path,
//                   distanceKm: distanceKm,
//                   timeStr: timeStr,
//                   paceStr: paceStr,
//                   runningDateStr: runningDate,
//                 );
//               },
//             ),
//           ],
//         ),
//       ],
//     );
//
//     return MaterialApp.router(
//       title: 'Crewer App',
//       theme: ThemeData(
//         scaffoldBackgroundColor: Colors.white,
//         primaryColor: const Color(0xFF9CB4CD),
//         visualDensity: VisualDensity.adaptivePlatformDensity,
//       ),
//       routerConfig: router,
//       debugShowCheckedModeBanner: false,
//     );
//   }
// }

// import 'package:client/providers/auth_provider.dart';
// import 'package:flutter/material.dart';
// import 'package:go_router/go_router.dart';
// import 'package:client/components/top_navbar.dart';
// import 'package:client/components/bottom_navbar.dart';
//
// import 'package:client/screens/feed_list_screen.dart';
// import 'package:client/screens/feed_create_screen.dart';
// import 'package:client/screens/feed_edit_screen.dart';
// import 'package:client/screens/feed_detail_screen.dart';
// import 'package:client/screens/group_feed_create_screen.dart';
// import 'package:client/screens/group_feed_edit_screen.dart';
// import 'package:client/screens/group_feed_detail_screen.dart';
// import 'package:client/screens/map_screen.dart';
// import 'package:client/screens/my_profile_screen.dart';
// import 'package:client/screens/user_profile_screen.dart';
// import 'package:client/screens/user_feed_screen.dart';
// import 'package:client/screens/signup_screen.dart';
// import 'package:client/screens/chatroom_list_screen.dart';
// import 'package:client/screens/chatroom_screen.dart';
// import 'package:client/screens/ranking_screen.dart';
// import 'package:client/components/login_modal_screen.dart';
// import 'package:client/screens/my_feed_screen.dart';
// import 'package:client/screens/my_liked_feed_screen.dart';
// import 'package:client/screens/running_route_screen.dart';
// import 'package:google_maps_flutter/google_maps_flutter.dart';
// import 'package:intl/intl.dart';
// import 'package:client/screens/follow_list_screen.dart';
// import 'package:provider/provider.dart';
//
// void main() {
//   WidgetsFlutterBinding.ensureInitialized();
//   runApp(
//     ChangeNotifierProvider(
//       // AuthProvider Ïù∏Ïä§ÌÑ¥Ïä§Î•º ÏÉùÏÑ±ÌïòÍ≥†, Ïï± ÏãúÏûë Ïãú Î°úÍ∑∏Ïù∏ ÏÉÅÌÉúÎ•º ÌôïÏù∏Ìï©ÎãàÎã§.
//       create: (context) => AuthProvider()..checkLoginStatus(),
//       child: const MyApp(),
//     ),
//   );
// }
//
// class MyApp extends StatelessWidget {
//   const MyApp({Key? key}) : super(key: key);
//
//   @override
//   Widget build(BuildContext context) {
//     final GoRouter router = GoRouter(
//       initialLocation: '/',
//       routes: [
//         ShellRoute(
//           builder: (context, state, child) {
//             final location = state.uri.toString();
//
//             // ÌïòÎã®Î∞î + ÏÉÅÎã®Î∞î Í∞ôÏù¥ Ïì∞Îäî ÌéòÏù¥ÏßÄ
//             final showBottomNav =
//                 ![
//                   '/feeds/create',
//                   '/groupfeeds/create',
//                   '/feeds/',
//                   '/groupfeeds/',
//                   '/signup',
//                   '/chat/',
//                 ].any((path) => location.startsWith(path));
//
//             return Scaffold(
//               backgroundColor: Colors.white,
//               appBar: TopNavBar(onBack: () => context.pop()),
//               bottomNavigationBar:
//                   showBottomNav
//                       ? BottomNavBar(currentLocation: location)
//                       : null,
//               body: child,
//             );
//           },
//           routes: [
//             GoRoute(path: '/', builder: (_, __) => FeedListScreen()),
//             GoRoute(path: '/signup', builder: (_, __) => SignupScreen()),
//             GoRoute(path: '/login', builder: (_, __) => LoginModalScreen()),
//             GoRoute(path: '/profile', builder: (_, __) => MyProfileScreen()),
//             GoRoute(path: '/map', builder: (_, __) => MapScreen()),
//             GoRoute(path: '/chat', builder: (_, __) => ChatRoomListScreen()),
//             GoRoute(path: '/ranking', builder: (_, __) => RankingScreen()),
//             GoRoute(
//               path: '/chat/:chatRoomId',
//               builder:
//                   (_, state) => ChatRoomScreen(
//                     chatRoomId: state.pathParameters['chatRoomId']!,
//                   ),
//             ),
//             GoRoute(
//               path: '/feeds/create',
//               builder: (_, __) => FeedCreateScreen(),
//             ),
//             GoRoute(
//               path: '/groupfeeds/create',
//               builder: (_, __) => GroupFeedCreateScreen(),
//             ),
//             GoRoute(
//               path: '/feeds/:feedId',
//               builder:
//                   (_, state) =>
//                       FeedDetailScreen(feedId: state.pathParameters['feedId']!),
//             ),
//             GoRoute(
//               path: '/feeds/:feedId/edit',
//               builder:
//                   (_, state) =>
//                       FeedEditScreen(feedId: state.pathParameters['feedId']!),
//             ),
//             GoRoute(
//               path: '/groupfeeds/:groupFeedId',
//               builder:
//                   (_, state) => GroupFeedDetailScreen(
//                     groupFeedId: state.pathParameters['groupFeedId']!,
//                   ),
//             ),
//             GoRoute(
//               path: '/groupfeeds/:groupFeedId/edit',
//               builder:
//                   (_, state) => GroupFeedEditScreen(
//                     groupFeedId: state.pathParameters['groupFeedId']!,
//                   ),
//             ),
//             GoRoute(
//               path: '/me/feeds',
//               builder: (context, state) => MyFeedScreen(),
//             ),
//             GoRoute(
//               path: '/me/liked-feeds',
//               builder: (context, state) => MyLikedFeedScreen(),
//             ),
//             GoRoute(
//               path: '/me/followers',
//               builder:
//                   (_, state) => FollowListScreen(
//                     username: 'me', // ÎÇ¥ ÌîÑÎ°úÌïÑÏùò Í≤ΩÏö∞ 'me'Î°ú Ï≤òÎ¶¨
//                     isFollowers: true,
//                   ),
//             ),
//             GoRoute(
//               path: '/me/following',
//               builder:
//                   (_, state) => FollowListScreen(
//                     username: 'me', // ÎÇ¥ ÌîÑÎ°úÌïÑÏùò Í≤ΩÏö∞ 'me'Î°ú Ï≤òÎ¶¨
//                     isFollowers: false,
//                   ),
//             ),
//             GoRoute(
//               path: '/user/:username',
//               builder:
//                   (_, state) => UserProfileScreen(
//                     username: state.pathParameters['username']!,
//                   ),
//             ),
//             GoRoute(
//               path: '/user/:username/feeds',
//               builder:
//                   (_, state) => UserFeedScreen(
//                     username: state.pathParameters['username']!,
//                   ),
//             ),
//             GoRoute(
//               path: '/user/:username/followers',
//               builder:
//                   (_, state) => FollowListScreen(
//                     username: state.pathParameters['username']!,
//                     isFollowers: true,
//                   ),
//             ),
//             GoRoute(
//               path: '/user/:username/following',
//               builder:
//                   (_, state) => FollowListScreen(
//                     username: state.pathParameters['username']!,
//                     isFollowers: false,
//                   ),
//             ),
//             GoRoute(
//               path: '/route',
//               builder: (context, state) {
//                 //state.extraÏóêÏÑú Ï†ÑÏ≤¥ Î†àÏΩîÎìú Í∫ºÎÇ¥Í∏∞
//                 final record = state.extra as Map<String, dynamic>;
//
//                 //Î†àÏΩîÎìú ÏãúÍ∞Ñ Ï†ïÎ≥¥
//                 final runningDate = DateFormat(
//                   'yyyyÎÖÑ MÏõî dÏùº \na hÏãú mÎ∂Ñ',
//                   'ko_KR',
//                 ).format(DateTime.parse(record['createdAt'] as String));
//
//                 //Í≤ΩÎ°ú(path) Î≥ÄÌôò: List<dynamic> ‚Üí List<LatLng>
//                 final rawPath = record['path'] as List<dynamic>;
//                 final path =
//                     rawPath
//                         .map(
//                           (p) => LatLng(
//                             p['latitude'] as double,
//                             p['longitude'] as double,
//                           ),
//                         )
//                         .toList();
//
//                 //Í±∞Î¶¨¬∑ÏãúÍ∞Ñ¬∑ÌéòÏù¥Ïä§ Í≥ÑÏÇ∞
//                 final distanceKm = (record['totalDistance'] as num) / 1000;
//                 final totalSeconds = record['totalSeconds'] as int;
//                 final totalTime = Duration(seconds: totalSeconds);
//                 final timeStr = [
//                   totalTime.inHours.toString().padLeft(2, '0'),
//                   (totalTime.inMinutes % 60).toString().padLeft(2, '0'),
//                   (totalTime.inSeconds % 60).toString().padLeft(2, '0'),
//                 ].join(':');
//                 final paceSec = (totalTime.inSeconds / distanceKm).round();
//                 final pace = Duration(seconds: paceSec);
//                 final paceStr =
//                     '${pace.inMinutes.toString().padLeft(2, '0')}:${(pace.inSeconds % 60).toString().padLeft(2, '0')}';
//
//                 // 4) RouteScreenÏóê Î™®Îì† Ï†ïÎ≥¥ Ï†ÑÎã¨
//                 return RouteScreen(
//                   path: path,
//                   distanceKm: distanceKm,
//                   timeStr: timeStr,
//                   paceStr: paceStr,
//                   runningDateStr: runningDate,
//                 );
//               },
//             ),
//           ],
//         ),
//       ],
//     );
//
//     return MaterialApp.router(
//       title: 'Crewer App',
//       theme: ThemeData(
//         scaffoldBackgroundColor: Colors.white,
//         primaryColor: const Color(0xFF9CB4CD),
//         visualDensity: VisualDensity.adaptivePlatformDensity,
//       ),
//       routerConfig: router,
//       debugShowCheckedModeBanner: false,
//     );
//   }
// }
